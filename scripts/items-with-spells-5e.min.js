class ItemsWithSpells5e{static MODULE_ID="items-with-spells-5e";static SETTINGS={};static FLAGS={itemSpells:"item-spells",parentItem:"parent-item",knownUuid:"original-uuid"};static TEMPLATES={spellsTab:`modules/${ItemsWithSpells5e.MODULE_ID}/templates/spells-tab.hbs`,overrides:`modules/${ItemsWithSpells5e.MODULE_ID}/templates/overrides-form.hbs`};static init(){ItemsWithSpells5e.preloadTemplates()}static preloadTemplates(){dnd5e.utils.registerHandlebarsHelpers(),loadTemplates(ItemsWithSpells5e.TEMPLATES)}static isIwsItem(e){"string"==typeof e&&(e=fromUuidSync(e));const t=e?.getFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.itemSpells)??[];return t.length?t:null}static getSpellParentId(e){return"string"==typeof e&&(e=fromUuidSync(e)),e.getFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.parentItem)??null}static async getSpellParentItem(e,t=!1,s=!1){if("string"==typeof e&&(e=await fromUuid(e)),t&&!e.isEmbedded)return null;const i=ItemsWithSpells5e.getSpellParentId(e);if(!i)return null;const l=s??e.actor?.items??!1;if(t&&!l)return null;if(l){const e=i.split(".").pop();return l.get(e)??null}return await fromUuid(i)}static isIncludedItemType(e){let t=!1;try{t=!!game.settings.get(ItemsWithSpells5e.MODULE_ID,`isIncludedItemType${e.titleCase()}`)}catch{}return t}static isUsableItem(e){if("string"==typeof e&&(e=fromUuidSync(e)),!1===e.system?.identified)return!1;if(game.settings.get(ItemsWithSpells5e.MODULE_ID,"excludeUnequipped")&&!1===e.system.equipped)return!1;if(!game.user.isGM)if(foundry.utils.isNewerVersion(game.system.version,"3.1.99")){if("required"===e.system?.attunement&&!e.system?.attuned)return!1}else{const t=CONFIG.DND5E.attunementTypes?.REQUIRED??1;if(e.system?.attunement===t)return!1}return!0}}class ItemsWithSpells5eActorSheet{static init(){const e=ItemsWithSpells5e.MODULE_ID,t=ItemsWithSpells5eActorSheet.prepareItemSpellbook;["Character","NPC"].forEach((s=>{libWrapper.register(e,`dnd5e.applications.actor.ActorSheet5e${s}.prototype._prepareSpellbook`,t,"WRAPPER")}))}static prepareItemSpellbook(e,t,s){const i=game.settings.get(ItemsWithSpells5e.MODULE_ID,"sortOrder")?20:-5,l=[],a=new Map;s.forEach((e=>{const t=ItemsWithSpells5e.getSpellParentId(e);if(t&&this.actor.items.some((e=>[e.id,e.uuid].includes(t)))){const s=t.split(".").pop();a.get(s)||a.set(s,[]),a.get(s).push(e)}else l.push(e)}));const n=e(t,l);return this.actor.items.filter((e=>{const t=e.getFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.itemSpells)?.length;if(!t)return!1;return ItemsWithSpells5e.isIncludedItemType(e.type)})).forEach((e=>{const t=a.get(e.id);if(!t)return;if(!ItemsWithSpells5e.isUsableItem(e))return;const s=((e,t={},s=[])=>({order:i,label:e.name,usesSlots:!1,canCreate:!1,canPrepare:!1,spells:s,uses:t.value??"-",slots:t.max??"-",override:0,dataset:{"iws-item-id":e.id},prop:"item-"+e.id}))(e,e.system.uses,t);n.push(s)})),n.sort(((e,t)=>e.order-t.order||e.label-t.label)),n}}class ItemsWithSpells5eActor{static init(){Hooks.on("createItem",ItemsWithSpells5eActor.handleCreateItem),Hooks.on("deleteItem",ItemsWithSpells5eActor.handleDeleteItem)}static async handleDeleteItem(e,t,s){if(s!==game.user.id)return;if(!(e.parent instanceof Actor))return;if(["group","vehicle"].includes(e.parent.type))return;if(!ItemsWithSpells5e.isIwsItem(e))return;const i=e.actor.items.reduce(((t,s)=>{const i=ItemsWithSpells5e.getSpellParentId(s);return[e.id,e.uuid].includes(i)&&t.push(s.id),t}),[]);if(!i.length)return;const l=t.itemsWithSpells5e?.alsoDeleteChildSpells,a=!game.user.isGM&&!1===e.system?.identified;return!!(l??a)||await Dialog.confirm({title:game.i18n.localize("IWS.MODULE_NAME"),content:game.i18n.localize("IWS.QUERY_ALSO_DELETE")})?e.actor.deleteEmbeddedDocuments("Item",i):void 0}static async handleCreateItem(e,t,s){if(s!==game.user.id)return;if(!(e.parent instanceof Actor))return;if(["group","vehicle"].includes(e.parent.type))return;if(!ItemsWithSpells5e.isIncludedItemType(e.type))return;const i=ItemsWithSpells5e.isIwsItem(e);if(!i)return;const l=await Promise.all(i.map((t=>ItemsWithSpells5eActor._createSpellData(e,t)))),a=[],n=l.filter(((e,t)=>!!e&&a.push(i[t]?.changes))),m=(await e.actor.createEmbeddedDocuments("Item",n)).map(((e,t)=>({uuid:e.uuid,id:e.id,changes:a[t]})));return e.setFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.itemSpells,m)}static async _createSpellData(e,t){const s=await fromUuid(t.uuid);if(!s)return null;const i=t.changes?.system||{};i.attackBonus&&!i.attack?i.attack={bonus:i.attackBonus,flat:!0}:i.attack?.bonus&&(i.attack.flat=!0);const l=i.uses?.max;if(l){const t=e.getRollData({deterministic:!0});i.uses.value=dnd5e.utils.simplifyBonus(l,t)}i.consume?.amount&&(i.consume.type="charges",i.consume.target=e.id);const a=game.items.fromCompendium(s),n={[`flags.${ItemsWithSpells5e.MODULE_ID}.${ItemsWithSpells5e.FLAGS.parentItem}`]:e.id,system:{...i,"preparation.mode":"atwill"}},m=s.flags["tidy5e-sheet"]?.section;return m&&(n["flags.tidy5e-sheet.section"]=null),foundry.utils.mergeObject(a,n)}}class ItemsWithSpells5eItemSpellOverrides extends FormApplication{constructor(e,t){const s=e.itemSpellFlagMap.get(t);super(s?.changes??{}),this.itemSpellId=t,this.itemWithSpellsItem=e,this.item=e.item,this.itemSpellItem=e.itemSpellItemMap.get(t)}get id(){return`${ItemsWithSpells5e.MODULE_ID}-${this.item.id}-${this.itemSpellItem.id}`}get title(){return`${this.item.name} - ${this.itemSpellItem.name}`}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{classes:["dnd5e","sheet","item","iws"],template:ItemsWithSpells5e.TEMPLATES.overrides,width:560,closeOnSubmit:!1,submitOnChange:!0,height:"auto"})}getData(){const e=this.item.system.uses||{},t=this.object;t.system?.attackBonus&&(t.system=foundry.utils.mergeObject(t.system,{"attack.bonus":t.system.attackBonus}));return{hasAttack:this.itemSpellItem.hasAttack,hasSave:this.itemSpellItem.hasSave,save:this.itemSpellItem.system.save,overrides:t,config:{limitedUsePeriods:CONFIG.DND5E.limitedUsePeriods,abilities:CONFIG.DND5E.abilities,spellLevels:CONFIG.DND5E.spellLevels,saveScaling:{spell:{label:"DND5E.Spellcasting"},...CONFIG.DND5E.abilities,flat:{label:"DND5E.Flat"}}},isFlatDC:"flat"===t?.system?.save?.scaling,spell:this.itemSpellItem,parentItem:{id:this.item.id,name:this.item.name,isEmbedded:this.item.isEmbedded,hasUses:this.item.hasLimitedUses&&e.per in CONFIG.DND5E.limitedUsePeriods&&e.max>0}}}async _updateObject(e,t){const s=foundry.utils.expandObject(t);this.object=s.overrides,e instanceof SubmitEvent?(await this.itemWithSpellsItem.updateItemSpellOverrides(this.itemSpellId,this.object),this.close()):this.render()}}class ItemsWithSpells5eItem{constructor(e){this.item=e,this._itemSpellFlagMap=null,this._itemSpellItems=null}get itemSpellFlagMap(){return null===this._itemSpellFlagMap?this._getItemSpellFlagMap():this._itemSpellFlagMap}get itemSpellList(){return this.item.getFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.itemSpells)??[]}get itemSpellItemMap(){return null===this._itemSpellItems?this._getItemSpellItems():this._itemSpellItems}async refresh(){this._getItemSpellFlagMap(),await this._getItemSpellItems()}async _getChildItem({uuid:e,changes:t={}}){let s=await fromUuid(e);if(s||(s=((e,t)=>new Item.implementation({name:game.i18n.localize("IWS.MISSING_ITEM"),img:"icons/svg/hazard.svg",type:"spell",system:{description:{value:game.i18n.localize("IWS.MISSING_ITEM_DESCRIPTION")}},_id:e.split(".").pop()},{temporary:!0,parent:t}))(e,this.item.parent)),[this.item.id,this.item.uuid].includes(ItemsWithSpells5e.getSpellParentId(s)))return s;t.system&&t.system.attackBonus&&!t.system.attack?t.system.attack={bonus:t.system.attackBonus,flat:!0}:t.system&&t.system.attack?.bonus&&(t.system.attack.flat=!0);const i=foundry.utils.mergeObject(t,this._getFlagFixObject(s));i[`flags.${ItemsWithSpells5e.MODULE_ID}.${ItemsWithSpells5e.FLAGS.knownUuid}`]=e,foundry.utils.getProperty(t,"system.consume.amount")&&foundry.utils.mergeObject(i,{"system.consume.type":"charges","system.consume.target":this.item.id});const l=new Item.implementation(s.toObject(),{temporary:!0,keepId:!1,parent:this.item.parent});return await l.updateSource(i),l}async _getItemSpellItems(){const e=new Map;return await Promise.all(this.itemSpellList.map((async({uuid:t,changes:s})=>{const i=await this._getChildItem({uuid:t,changes:s});if(i)return e.set(i.id,i),i}))),this._itemSpellItems=e,e}_getItemSpellFlagMap(){const e=new Map;return this.itemSpellList.forEach((t=>{const s=t.uuid.split(".").pop();e.set(s,t)})),this._itemSpellFlagMap=e,e}_getFlagFixObject(e){const t={[`flags.${ItemsWithSpells5e.MODULE_ID}.${ItemsWithSpells5e.FLAGS.parentItem}`]:this.item.uuid,"system.preparation.mode":"atwill"},s=e.flags["tidy5e-sheet"]?.section;return s&&(t["flags.tidy5e-sheet.section"]=null),t}async addSpellToItem(e){let t=e;if(this.item.isEmbedded){const e=await fromUuid(t);if(!e)return void ui.notifications.error("Item data for",t,"not found");const s=this._getFlagFixObject(e),i=foundry.utils.mergeObject(e.toObject(),s),[l]=await this.item.actor.createEmbeddedDocuments("Item",[i]);t=l.uuid}const s=[...this.itemSpellList,{uuid:t}],i=`flags.${ItemsWithSpells5e.MODULE_ID}.${ItemsWithSpells5e.FLAGS.itemSpells}`;await this.item.update({[i]:s},{render:!1}),await this.refresh(),this.item.render(),this.item.actor&&this.item.actor.render()}async removeSpellFromItem(e,{alsoDeleteEmbeddedSpell:t}={}){const s=this.itemSpellItemMap.get(e),i=this.item.isEmbedded?s.uuid:s.getFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.knownUuid),l=this.itemSpellList.filter((({uuid:e})=>e!==i));if(this._itemSpellItems?.delete(e),this._itemSpellFlagMap?.delete(e),await this.item.setFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.itemSpells,l),!this.item.isEmbedded)return;const a=fromUuidSync(i);if(!a)return;return t&&await Dialog.confirm({title:game.i18n.localize("IWS.MODULE_NAME"),content:game.i18n.localize("IWS.WARN_ALSO_DELETE")})?a.delete():a.unsetFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.parentItem)}async updateItemSpellOverrides(e,t){const s=this.itemSpellFlagMap.get(e);s.changes=t,this.itemSpellFlagMap.set(e,s);const i=[...this.itemSpellFlagMap.values()];await this.item.update({[`flags.${ItemsWithSpells5e.MODULE_ID}.${ItemsWithSpells5e.FLAGS.itemSpells}`]:i},{render:!1}),await this.refresh(),ItemsWithSpells5eItemSheet.instances.forEach((e=>{e.itemWithSpellsItem===this&&(e._shouldOpenSpellsTab=!0)})),this.item.render()}static async getItemSpells(e,t=!1,s=!1){if("string"==typeof e&&(e=await fromUuid(e)),t&&!e.isEmbedded)return null;const i=new ItemsWithSpells5eItem(e);if(!i.itemSpellList.length)return null;const l=!!(s??t)&&e.actor?.items;if(t&&!l)return null;if(l){const t=new Map,s=[e.id??e._id,e.uuid];return l.forEach((e=>{const i=ItemsWithSpells5e.getSpellParentId(e);s.includes(i)&&t.set(e.id,e)})),t}return await i.itemSpellItemMap}}class ItemsWithSpells5eItemSheet{_shouldOpenSpellsTab=!1;constructor(e,[t]){this.app=e,this.item=e.item,this.sheetHtml=t,this.itemWithSpellsItem=new ItemsWithSpells5eItem(this.item)}static instances=new Map;static init(){Hooks.on("renderItemSheet",((e,t)=>{if(game.modules.get("tidy5e-sheet")?.api?.isTidy5eItemSheet(e)||!ItemsWithSpells5e.isIncludedItemType(e.item.type))return;const s=ItemsWithSpells5eItemSheet.instances.get(e.appId);if(s)return s.renderLite(),void(s._shouldOpenSpellsTab&&(e._tabs?.[0]?.activate?.(ItemsWithSpells5e.MODULE_ID),s._shouldOpenSpellsTab=!1));const i=new ItemsWithSpells5eItemSheet(e,t);return ItemsWithSpells5eItemSheet.instances.set(e.appId,i),i.renderLite()})),Hooks.on("closeItemSheet",(async e=>{const t=ItemsWithSpells5eItemSheet.instances.get(e.appId);if(t)return await t._unlinkSpellSheets(),ItemsWithSpells5eItemSheet.instances.delete(e.appId)})),Hooks.once("tidy5e-sheet.ready",(e=>{const t=new e.models.HtmlTab({title:game.i18n.localize("TYPES.Item.spellPl"),tabId:ItemsWithSpells5e.MODULE_ID,html:"",enabled:e=>ItemsWithSpells5e.isIncludedItemType(e.item.type),onRender(e){if(!ItemsWithSpells5e.isIncludedItemType(e.data.item.type))return;let t=e.app,s=[e.element];const i=ItemsWithSpells5eItemSheet.instances.get(t.appId);if(i)i.renderHeavy(e.tabContentsElement);else{const i=new ItemsWithSpells5eItemSheet(t,s);ItemsWithSpells5eItemSheet.instances.set(t.appId,i),i.renderHeavy(e.tabContentsElement)}}});e.registerItemTab(t,{autoHeight:!0})}))}async _renderSpellsList(){await this.itemWithSpellsItem.refresh();const e=[...(await this.itemWithSpellsItem.itemSpellItemMap).values()];return await this._linkSpellSheets(),renderTemplate(ItemsWithSpells5e.TEMPLATES.spellsTab,{itemSpells:e,config:{limitedUsePeriods:CONFIG.DND5E.limitedUsePeriods,abilities:CONFIG.DND5E.abilities},isEmbedded:this.item.isEmbedded,isOwner:this.item.isOwner,concealDetails:!game.user.isGM&&!1===this.item.system.identified})}async _dragEnd(e){if(!this.app.isEditable)return;const t=TextEditor.getDragEventData(e);if("Item"!==t.type)return;return"spell"===(await fromUuid(t.uuid)).type?(this._shouldOpenSpellsTab=!0,this.itemWithSpellsItem.addSpellToItem(t.uuid)):void 0}async _handleItemClick(e){const t=e.currentTarget.closest("[data-item-id]").dataset.itemId,s=this.itemWithSpellsItem.itemSpellItemMap.get(t);this.item.isEmbedded?fromUuidSync(s.uuid).use({event:e}):s?.sheet.render(!0,{editable:!1})}async _handleItemEditClick(e){const t=e.currentTarget.closest("[data-item-id]").dataset.itemId,s=this.itemWithSpellsItem.itemSpellItemMap.get(t);let i=s;if(!s.isEmbedded){const e=s.getFlag(ItemsWithSpells5e.MODULE_ID,ItemsWithSpells5e.FLAGS.knownUuid);i=await fromUuid(e)}i?.sheet.render(!0)}async _handleItemDeleteClick(e){const t=e.currentTarget.closest("[data-item-id]").dataset.itemId;return this._shouldOpenSpellsTab=!0,this.itemWithSpellsItem.removeSpellFromItem(t)}async _handleItemDestroyClick(e){const t=e.currentTarget.closest("[data-item-id]").dataset.itemId;return this._shouldOpenSpellsTab=!0,this.itemWithSpellsItem.removeSpellFromItem(t,{alsoDeleteEmbeddedSpell:!0})}async _handleOverridesConfigureClick(e){const t=e.currentTarget.closest("[data-item-id]").dataset.itemId,s=this.itemWithSpellsItem.itemSpellItemMap.get(t);return this.item.isEmbedded?fromUuidSync(s.uuid).sheet.render(!0):(s.sheet.rendered&&s.sheet.close(),new ItemsWithSpells5eItemSpellOverrides(this.itemWithSpellsItem,t).render(!0))}renderLite(){const e=document.createElement("DIV");e.innerHTML=`<a class="item" data-tab="${ItemsWithSpells5e.MODULE_ID}">${game.i18n.localize("TYPES.Item.spellPl")}</a>`;const t=this.sheetHtml.querySelector(".tabs[data-group=primary]");if(!t)return;t.appendChild(e.firstElementChild);const s=this.sheetHtml.querySelector(".sheet-body");e.innerHTML=`<div class="tab ${ItemsWithSpells5e.MODULE_ID}" data-group="primary" data-tab="${ItemsWithSpells5e.MODULE_ID}"></div>`;const i=e.firstElementChild;s.appendChild(i),this.renderHeavy(i)}async renderHeavy(e){const t=document.createElement("DIV");t.innerHTML=await this._renderSpellsList();const s=t.firstElementChild;e.appendChild(s),s.querySelectorAll(".item-name").forEach((e=>e.addEventListener("click",this._handleItemClick.bind(this)))),s.querySelectorAll(".configure-overrides").forEach((e=>e.addEventListener("click",this._handleOverridesConfigureClick.bind(this)))),s.querySelectorAll(".item-edit").forEach((e=>e.addEventListener("click",this._handleItemEditClick.bind(this)))),s.querySelectorAll(".item-delete").forEach((e=>e.addEventListener("click",this._handleItemDeleteClick.bind(this)))),s.querySelectorAll(".item-destroy").forEach((e=>e.addEventListener("click",this._handleItemDestroyClick.bind(this))));const i={dragSelector:".item",dropSelector:`.${ItemsWithSpells5e.MODULE_ID}`,permissions:{drop:()=>this.app.isEditable&&!this.item.isEmbedded},callbacks:{drop:this._dragEnd}};e.addEventListener("drop",i.callbacks.drop.bind(this))}async _linkSpellSheets(){return Promise.all(this.itemWithSpellsItem.itemSpellList.map((async({uuid:e,overrides:t})=>{const s=await fromUuid(e);return s&&(s.apps[this.app.appId]=this.app),s})))}async _unlinkSpellSheets(){return Promise.all(this.itemWithSpellsItem.itemSpellList.map((async({uuid:e,overrides:t})=>{const s=await fromUuid(e);return s.apps[this.app.appId]&&delete s.apps[this.app.appId],s})))}}const e=["class","subclass","background","race","lineage","spell","base","container","backpack"];class IWS_TypeSettings extends FormApplication{get id(){return`${ItemsWithSpells5e.MODULE_ID}-item-type-exclusion-menu`}get title(){return game.i18n.localize("IWS.SETTINGS.ITEM_EXCLUSION.TITLE")}get template(){return"modules/items-with-spells-5e/templates/settingsMenu.hbs"}async getData(){const t=Item.TYPES.filter((t=>!e.includes(t))),s=await super.getData();s.types=[];for(const e of t)s.types.push({checked:game.settings.get(ItemsWithSpells5e.MODULE_ID,`isIncludedItemType${label}`),value:e,label:game.i18n.localize(`TYPES.Item.${e}`)});return s.sort(((e,t)=>e.label>t.label?1:e.label<t.label?-1:0))}async _updateObject(e,t){Object.entries(t).forEach((([e,t])=>{game.settings.set(ItemsWithSpells5e.MODULE_ID,`isIncludedItemType${e.titleCase()}`,t)}))}}let t=null;class ItemsWithSpells5eExtendHUD{static init(){game.modules.get("token-action-hud-core")?.active&&game.modules.get("token-action-hud-dnd5e")?.active&&foundry.utils.isNewerVersion(game.modules.get("token-action-hud-dnd5e")?.version,"1.5.6")&&(Hooks.once("tokenActionHudCoreRegisterDefaults",(async e=>{const t="Items with Spells",s=e.layout.find((e=>"spells"===e.id)),i={id:ItemsWithSpells5e.MODULE_ID,name:t,listName:`Group: ${t}`,type:"system",nestId:`spells_${ItemsWithSpells5e.MODULE_ID}`};e.groups.push(i),s.groups.unshift(i)})),Hooks.once("tokenActionHudCoreApiReady",(async s=>{t=class ItemsWithSpellsActionHandlerExtender extends s.api.ActionHandlerExtender{constructor(e){super(),this.actionHandler=e,this.actor=null,this.iwsExcludeUnequipped=null}async extendActionHandler(){if(this.actor=this.actionHandler.actor,!this.actor)return;this.iwsExcludeUnequipped=game.settings.get(ItemsWithSpells5e.MODULE_ID,"excludeUnequipped");const t={id:ItemsWithSpells5e.MODULE_ID,type:"system"};for(const[i,l]of this.actor.items.entries()){if(e.includes(l.type))continue;if(!ItemsWithSpells5e.isUsableItem(l))continue;const i=await ItemsWithSpells5eItem.getItemSpells(l,!0,this.actor.items);if(!i)continue;const a={},n=l?.system?.uses;if(n?.per&&(n.value>0||n.max>0)){const e=s.api.Utils.i18n("DND5E.per"),t=CONFIG.DND5E.limitedUsePeriods[n.per]?.label??n.per,i="charges"===n.per?t:`${e} ${t}`;a.text=`${n.value??"0"}${n.max>0?`/${n.max}`:""}`,a.title=`${l.name}: ${a.text} ${i}`}const m={id:`${ItemsWithSpells5e.MODULE_ID}_${l.id}`,name:l.name,type:"system-derived",info1:a,defaultSelected:!0,settings:{sort:!0}};this.actionHandler.addGroup(m,t);const r={groupData:m,actionData:i,actionType:"spell"};await this.actionHandler.buildActions(r)}}}})),Hooks.once("tokenActionHudCoreAddActionHandlerExtenders",(async e=>{e.addActionHandlerExtender(new t(e))})))}}Hooks.once("setup",(function _registerSettings(){const t=Item.TYPES.filter((t=>!e.includes(t)));for(const e of t)game.settings.register(ItemsWithSpells5e.MODULE_ID,`isIncludedItemType${e.titleCase()}`,{scope:"world",config:!1,type:Boolean,default:!0,requiresReload:!0});game.settings.register(ItemsWithSpells5e.MODULE_ID,"sortOrder",{name:"IWS.SETTINGS.SORT_ORDER.NAME",hint:"IWS.SETTINGS.SORT_ORDER.HINT",scope:"world",config:!0,type:Boolean,default:!1,requiresReload:!1}),game.settings.registerMenu(ItemsWithSpells5e.MODULE_ID,"itemTypeExclusion",{name:"IWS.SETTINGS.ITEM_EXCLUSION.NAME",hint:"IWS.SETTINGS.ITEM_EXCLUSION.HINT",scope:"world",config:!0,type:IWS_TypeSettings,label:"IWS.SETTINGS.ITEM_EXCLUSION.NAME",restricted:!0}),game.settings.register(ItemsWithSpells5e.MODULE_ID,"excludeUnequipped",{name:"IWS.SETTINGS.EXCLUDE_UNEQUIPPED.NAME",hint:"IWS.SETTINGS.EXCLUDE_UNEQUIPPED.HINT",scope:"world",config:!0,type:Boolean,default:!0,requiresReload:!1})})),Hooks.once("init",ItemsWithSpells5eActor.init),Hooks.once("init",ItemsWithSpells5eActorSheet.init),Hooks.once("init",ItemsWithSpells5e.init),Hooks.once("init",ItemsWithSpells5eItemSheet.init),Hooks.once("init",ItemsWithSpells5eExtendHUD.init),Hooks.once("ready",(async()=>{game.modules.get(ItemsWithSpells5e.MODULE_ID).api={isIwsItem:ItemsWithSpells5e.isIwsItem,isIwsSpell:ItemsWithSpells5e.getSpellParentId,getItemSpells:ItemsWithSpells5eItem.getItemSpells,getSpellParentId:ItemsWithSpells5e.getSpellParentId,getSpellParentItem:ItemsWithSpells5e.getSpellParentItem,isIncludedItemType:ItemsWithSpells5e.isIncludedItemType,isUsableItem:ItemsWithSpells5e.isUsableItem}}));export{ItemsWithSpells5e,ItemsWithSpells5eActor,ItemsWithSpells5eActorSheet,ItemsWithSpells5eExtendHUD,ItemsWithSpells5eItem,ItemsWithSpells5eItemSheet,ItemsWithSpells5eItemSpellOverrides};
//# sourceMappingURL=items-with-spells-5e.min.js.map
